<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="common/layout">
<head>
    <meta charset="UTF-8"/>
    <title>产品添加</title>
    <link rel="stylesheet" href="/resources/plugins/datatables/media/css/dataTables.bootstrap.min.css"/>
    <link rel="stylesheet"
          href="/resources/plugins/datatables/extensions/jquery-datatables-checkboxes/css/dataTables.checkboxes.css"/>
</head>
<body>
<div layout:fragment="content">
    <section class="content-header">
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i>首页</a></li>
            <li class="active">产品添加</li>
        </ol>
    </section>
    <section class="content">
        <div class="row">
            <div class="col-xs-12" style="padding-top: 30px">
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title">产品添加</h3>
                        <button type="button" class="btn btn-primary createbutton" onclick="back()">返回</button>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body"  style="align-content: center">
                        <form action="" class="form-horizontal form-label-left">
                            <div class="form-group">
                                <label class="control-label col-md-2">请输入产品名称：<span style="color: red">*</span></label>
                                <div class="col-md-6  col-sm-12 col-xs-12">
                                    <input type="text" class="form-control" placeholder="请输入产品名称" name="name"
                                           id="name">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">类型：<span style="color: red">*</span></label>
                                <div class="col-md-6  col-sm-12 col-xs-12">
                                    <select class="form-control" id="type" name="type">
                                        <option value="">请选择类型</option>
                                        <option value="衣服">衣服</option>
                                        <option value="鞋">鞋</option>
                                        <option value="器材">器材</option>
                                        <option value="器具">器具</option>

                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">图片：<span style="color: red">*</span></label>
                                <div class="col-md-6  col-sm-12 col-xs-12">
                                    <input class="form-control" id="pic" name="pic" placeholder="图片" type="file" />

                                    <!--<img src="" id="imgsrc" style="width:50%;height:50%;">-->
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2 col-xs-3">单价:</label>
                                <div class="col-md-2 col-sm-12 col-xs-12">
                                    <input class="form-control" id="price" name="price" placeholder="单价/天" type="text" />
                                </div>
                                <label class="control-label col-md-2 col-xs-3">押金:</label>
                                <div class="col-md-2 col-sm-12 col-xs-12">
                                    <input class="form-control" id="deposit" name="deposit" placeholder="押金" type="text" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">内容：<span style="color: red">*</span></label>
                                <div class="col-md-6 col-sm-12 col-xs-12">
                                    <script id="editor" type="text/plain"></script>
                                    <!--<textarea class="form-control" placeholder="内容" id="data" name="essaycontent"  style="width: 100%;height: 800px"></textarea>-->
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2 col-xs-3">是否预定:</label>
                                <div class="col-md-2 col-sm-12 col-xs-12">
                                    <select class="form-control" id="isuse" name="isuse">
                                        <option value="">请选择类型</option>
                                        <option value="1">已预定</option>
                                        <option value="0">未预定</option>
                                    </select>
                                </div>
                                <label class="control-label col-md-2 col-xs-3">是否损坏:</label>
                                <div class="col-md-2 col-sm-12 col-xs-12">
                                    <select class="form-control" id="isdefect" name="isdefect">
                                        <option value="">请选择类型</option>
                                        <option value="1">损坏</option>
                                        <option value="0">未损坏</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">破损描述:</label>
                                <div class="col-md-6 col-sm-12 col-xs-12">
                                    <textarea class="form-control" id="defectstr" name="defectstr" style="height: 100px;"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2">编码号：<span style="color: red">*</span></label>
                                <div class="col-md-6  col-sm-12 col-xs-12">
                                    <input type="text" class="form-control" placeholder="编码号" name="code"
                                           id="code">
                                </div>
                            </div>
                            <div class="ln_solid"></div>
                            <div class="form-group">
                                <div class="col-md-9 col-sm-9 col-xs-12 col-md-offset-3">
                                    <button type="reset" class="btn btn-primary">重置</button>
                                    <div  class="btn btn-success" onclick="ajaxFileUpload()">确认提交</div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- /.box-body -->
                </div>
            </div>
        </div>
    </section>
    <script src="/resources/plugins/page/page.js"></script>
    <script type="text/javascript" charset="utf-8" src="/resources/plugins/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="/resources/plugins/ueditor/ueditor.all.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="/resources/plugins/ueditor/lang/zh-cn/zh-cn.js"></script>
    <script src="/resources/plugins/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="/resources/plugins/datatables/media/js/dataTables.bootstrap.min.js"></script>
    <script src="/resources/plugins/datatables/extensions/jquery-datatables-checkboxes/js/dataTables.checkboxes.min.js"></script>
    <script src="/resources/plugins/sweetalert/sweetalert.min.js"></script>
    <link rel="stylesheet" href="/resources/plugins/sweetalert/sweetalert.css"/>


    <!--<script src="/resources/plugins/jQuery/jquery-2.2.3.min.js"></script>-->
    <script src="/resources/js/ajaxfileupload.js"></script>
    <script>

        var ue = UE.getEditor('editor');
        UE.Editor.prototype._bkGetActionUrl=UE.Editor.prototype.getActionUrl;
        UE.Editor.prototype.getActionUrl=function(action){
            if (action == 'uploadimage'){
                return '/config/uploadimage';    /* 这里填上你自己的上传图片的action */
            }else{
                return this._bkGetActionUrl.call(this, action);
            }
        };
        var picpath = "";
        function ajaxFileUpload() {  //ajaxFileUpload上传用户头像（我的简历中的基本信息模块）, <input type="file" id="Image" name="Image" onchange="ajaxFileUpload()" />成功
            var pic=$("#pic").val();
            console.log(pic!=null&&pic!="")
            if(pic!=null&&pic!=""){
                $.ajaxFileUpload({
                    url: '../file/uploadimage', //用于文件上传的服务器端请求地址
                    type: "post",
                    secureuri: false, //一般设置为false
                    fileElementId: 'pic', //文件上传空间的id属性  <input type="file" id="file1" name="file" />
                    dataType: 'application/json', //返回值类型 一般设置为json
                    success: function (data)  //服务器成功响应处理函数
                    {
                        console.log(data)
                        datas = data.data;
                        if (data.state == 1) {
                            picpath=datas[0].id;
                            tosubmit();
                        }
                    },
                    error: function (data, status, e)//服务器响应失败处理函数
                    {
                        alert(e);
                    }
                });//end ajaxfile
            }else {
                tosubmit();
            }
        }

        function tosubmit() {
            var name =$("#name").val();
            var type =$("#type option:selected").val();
            var price =$("#price").val();
            var deposit =$("#deposit").val();
            var content =  UE.getEditor('editor').getContent();
            var isuse =$("#isuse option:selected").val();
            var isdefect =$("#isdefect option:selected").val();
            var defectstr =$("#defectstr").val();
            var code =$("#code").val();

            var skiingOrderEntity = {
                "name": name,
                "type":type,
                "price":price,
                "deposit":deposit,
                "content":content,
                "isuse":isuse,
                "isdefect":isdefect,
                "defectstr":defectstr,
                "code":code,
                "src":picpath,

            };
            console.log(JSON.stringify(skiingOrderEntity));
            $.ajax({
                url: "../order/add",
                data:JSON.stringify(skiingOrderEntity),
                type: "post",
                contentType: "application/json;chrset=UTF-8",
                success: function (data) {
                    $("#load-layout").hide()
                    if (data.state == 1) {
                        swal({
                            title: "提示",
                            text: "创建成功！",
                            type: "success"
                        }, function () {
                            location.href="/order/toorderlist";
                        })
                    }
                }
            });

        }

        function back() {
            history.back();
        }

        var pic = null;
        window.onload = function(){
            // 抓取上传图片，转换代码结果，显示图片的dom
            var img_upload=document.getElementById("pic");
            // 添加功能出发监听事件
            img_upload.addEventListener('change',readFile,false);}
        function readFile() {
            var file = this.files[0];
            if (!/image\/\w+/.test(file.type)) {
                alert("请确保文件为图像类型");
                return false;
            }
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
                $("#imgsrc").attr("src", this.result);
                pic = this.result;
            }
        }

    </script>
</div>

</body>

</html>


